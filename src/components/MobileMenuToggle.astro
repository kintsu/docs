---
import type { Props } from "@astrojs/starlight/props";
import MobileMenuButton from "./MobileMenuButton.tsx";
---

<starlight-menu-button class="print:hidden" aria-expanded="false">
  <MobileMenuButton client:load />
</starlight-menu-button>

<script>
  class StarlightMenuButton extends HTMLElement {
    constructor() {
      super();
      
      // Close the menu when a user presses the escape key
      const parentNav = this.closest('nav');
      if (parentNav) {
        parentNav.addEventListener('keyup', (e: KeyboardEvent) => {
          if (e.code === 'Escape') {
            this.setExpanded(false);
            this.querySelector('button')?.focus();
          }
        });
      }
    }

    setExpanded(expanded: boolean) {
      this.setAttribute('aria-expanded', String(expanded));
      document.body.toggleAttribute('data-mobile-menu-expanded', expanded);
    }
  }

  if (!customElements.get('starlight-menu-button')) {
    customElements.define('starlight-menu-button', StarlightMenuButton);
  }
</script>
