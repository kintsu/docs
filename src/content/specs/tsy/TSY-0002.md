---
author: joshua-auchincloss
components:
  - compiler
  - parser
created: 2025-10-30
kind: TSY
number: 2
status: draft
title: Struct Types
updates:
  - author: joshua-auchincloss
    date: 2025-10-30
    description: Created specification
version_after: 0.1.0
version_before: null
---

# TSY-0002: Struct Types

## Overview

This document is the normative type-system description for Kintsu struct types. It records the exact semantics the parser and resolver implement so that schema authors and downstream tooling can rely on stable, well-defined behaviour.

## Motivation

Struct types are the canonical composite type in Kintsu. The TSY text below defines field syntax, optionality, field metadata, and validation expectations for struct types. Anonymous struct promotion and union merging are described in separate TSY specs (TSY-0003 and TSY-0007 respectively); this document limits itself to the structural rules for `struct` declarations.

## Design Principles

- Explicitness: field optionality and separators are explicit in the surface syntax and must be preserved by parsers.
- Determinism: structural rules (field identity, optionality, and metadata) are specified so downstream tooling can rely on stable, well-defined shapes.
- Minimal surprise: field semantics are simple and predictable; merging/union semantics are handled in separate TSY documents.

## Type system rules (normative)

1. Field form and semantics

- A struct field (Arg) has the concrete surface form: identifier, separator token (indicating optionality), and a type expression.
- The parser maps separators into a `Sep` enum with two cases: `Required` and `Optional`. A leading `?` token denotes `Optional`.
- Field comments and metadata present in source are parsed into the AST and associated with the field. Tools may surface this metadata in documentation; generated or synthesized types (documented elsewhere) do not inherit source meta automatically.

2. Validation and metadata

- Struct declaration validation must ensure that field identifiers are unique within the struct scope. Duplicate field names in a single struct declaration are a validation error.
- Field optionality is a semantic property of the field. Parsers must preserve the separator token so downstream phases can accurately reason about required vs optional fields.
- Field comments and metadata are preserved in the AST. How tooling surfaces that metadata is an implementation decision; the TSY documents for anonymous structs will describe provenance rules for synthesized types.

3. Compatibility notes

- Implementations must keep the structural rules stable across compiler releases. Behaviour that synthesizes new types (anonymous promotion, union merging) is intentionally described in separate specs so that authors of `struct` declarations only need to depend on the structural contract documented here.

## Diagrams

The following diagrams illustrate the parser AST shape for `struct` declarations and the compilation registration flow.

![Struct Types](../../../../diagrams/struct_types.png)

![Struct Compilation](../../../../diagrams/struct_compilation.png)

## References

- [RFC-0002: Struct Types](/specs/rfc/rfc-0002)
- [SPEC-0002: Struct Compilation](/specs/spec/spec-0002)
