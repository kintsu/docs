---
author: joshua-auchincloss
components:
  - compiler
  - parser
created: 2025-10-30
kind: RFC
number: 2
status: draft
title: Struct Type Design
updates:
  - author: joshua-auchincloss
    date: 2025-10-30
    description: Created specification
version_after: 0.1.0
version_before: null
---

# RFC-0002: Struct Type Design

## Abstract

This RFC documents the design rationale for Kintsu `struct` types. It summarizes the parser and compiler behaviours that drive how struct values are described in source schemas, the trade-offs made to ensure deterministic compilation, and the conventions that make generated type names and documentation stable for interop.

## Motivation

Structs are the primary composite type in Kintsu: they group named fields, convey optionality, and serve as the unit of data interchange for operations and many higher-level type constructs. This RFC explains design choices that balance ergonomics for schema authors with the compiler's need for deterministic resolution and stable generated names. It is intended for protocol designers and implementers who must reason about interchange formats, migration, and backward compatibility.

## Specification

This section summarizes the user-facing syntax and the canonical behaviours the compiler implements. Detailed, normative rules appear in TSY-0002 and SPEC-0002.

- Syntax summary
  - Structs are declared with the `struct` keyword, a name, a brace-delimited field list, and a terminating semicolon. Each field is an `Arg` composed of an identifier, a separator indicating optionality, and a type expression.
  - Field separator semantics: a leading `?` denotes optionality; the required separator denotes mandatory fields. The parser represents this with `Sep` (Required | Optional).

- Determinism and compatibility
  - The compiler intentionally produces deterministic names and registration order so that generated artifacts and documentation remain stable across builds. This reduces churn in downstream code generators and helps human-read schema diffs.

Note: anonymous structs, union merging and merged-struct synthesis are documented in their own specifications (RFC-0003 / TSY-0003 / SPEC-0003 and RFC-0007 / TSY-0007 / SPEC-0007). This RFC is intentionally focused on the struct type itself.

## Rationale

Key rationale points

- Explicit optionality tokens: encoding optionality as visible separators in the syntax keeps schema intent explicit and avoids hidden defaults that can lead to brittle upgrades. This makes it easy for tooling to surface whether a field is required or optional, and keeps migration paths predictable when adding or removing fields.

- Deterministic compilation order: registering types in a topological order (dependencies before dependents) ensures that downstream code generators produce stable outputs and that documentation generation is reproducible. This stability is crucial for versioned APIs and helps avoid surprising diffs when regenerating client libraries.

- Preserving field metadata: comments and metadata attached to fields in source are carried through parsing and resolution so that documentation generators and schema browsers can surface this information. Schema authors rely on inline comments to document fields; making this a first-class language feature improves the developer experience.

## Acceptance Criteria

Enumerate the criteria that must be met for the specification to be considered complete and accepted. These will be referenced as `<spec_id>.AC-1`.

- [ ] AC-1: The RFC documents the rationale for explicit field separators (`?` for optional) and why this is preferable to implicit defaults.
- [ ] AC-2: The RFC explains how deterministic compilation order (topological sorting) benefits tooling and generated code stability.
- [ ] AC-3: The RFC links to TSY-0002 and SPEC-0002 for normative and implementer-facing details.

## Backwards Compatibility

This RFC documents compiler and schema-level behaviour for named struct types only. Future changes that alter field validation rules or registration ordering would be breaking for tooling consumers; such changes require explicit migration guidance and a versioned compatibility policy. Anonymous-struct extraction and union merging compatibility is documented in RFC-0003 and RFC-0007 respectively.

## References
