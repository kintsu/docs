---
author: joshua-auchincloss
components:
  - cli
created: 2025-12-26
kind: RFC
number: 27
status: draft
title: CLI Inspection Commands
updates:
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Removed --dev flag, added inspect command with --schema for virtual manifest viewing
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Created specification
version_after: 0.1.0
version_before: null
---

# RFC-0027: CLI Inspection Commands

## Summary

This RFC specifies the `list`, `info`, `tree`, and `inspect` CLI commands for inspecting dependencies, packages, and virtual manifests.

## Motivation

Developers need visibility into:

- Current dependencies and their versions
- Available package information from registries
- Dependency tree structure and relationships
- Virtual manifests derived from workspace configuration

These commands provide read-only introspection without modifying manifests or lockfiles.

## Specification

### kintsu list

Lists dependencies of the current schema.

#### Synopsis

```
kintsu list [OPTIONS]
```

#### Aliases

- `kintsu ls`

#### Options

| Option        | Short | Description                           |
| ------------- | ----- | ------------------------------------- |
| `--json`      |       | Output in JSON format                 |
| `--outdated`  | `-o`  | Show only outdated packages           |
| `--depth <N>` | `-d`  | Maximum dependency depth (default: 1) |
| `--workspace` | `-w`  | List workspace schemas                |

#### Behaviour

1. Read `schema.toml` and `schema.lock.toml`
2. Display direct dependencies by default
3. Check registry for updates when `--outdated`

#### Examples

```bash title="kintsu list"
# List direct dependencies
kintsu list

# Show outdated packages
kintsu list --outdated

# Show transitive dependencies
kintsu list --depth 3

# List workspace schemas
kintsu list --workspace

# JSON output
kintsu list --json
```

#### Output

**Default:**

```text title="kintsu list"
my-schema v1.0.0

Dependencies:
  common-types     ^2.0    2.3.1
  api-utils        ^1.0    1.2.0
```

**Outdated:**

```text title="kintsu list --outdated"
my-schema v1.0.0

Outdated Dependencies:
  Package          Current   Latest    Constraint
  common-types     2.3.1     2.4.0     ^2.0
  api-utils        1.2.0     2.0.0     ^1.0 (major)
```

**Workspace:**

```text title="kintsu list --workspace"
Workspace: my-workspace

Schemas:
  common           ./common           v1.0.0
  api              ./packages/api     v1.2.0
  internal         ./packages/internal v0.9.0

Workspace Dependencies:
  external-types   ^2.0    2.1.0
```

**JSON:**

```json title="kintsu list --json"
{
  "name": "my-schema",
  "version": "1.0.0",
  "dependencies": {
    "common-types": {
      "constraint": "^2.0",
      "locked": "2.3.1",
      "latest": "2.4.0"
    }
  }
}
```

#### Error Conditions

| Condition                                       | Description                   |
| ----------------------------------------------- | ----------------------------- |
| No schema.toml found                            | Not in a package or workspace |
| No schema.lock.toml found (for locked versions) | Lockfile doesn't exist        |

---

### kintsu info

Displays detailed information about a package.

#### Synopsis

```
kintsu info [OPTIONS] <PACKAGE>
```

#### Arguments

| Argument    | Description                               |
| ----------- | ----------------------------------------- |
| `<PACKAGE>` | Package name (optionally with `@version`) |

#### Options

| Option              | Short | Description                 |
| ------------------- | ----- | --------------------------- |
| `--registry <NAME>` | `-r`  | Query specific registry     |
| `--json`            |       | Output in JSON format       |
| `--versions`        | `-v`  | List all available versions |

#### Behaviour

1. Query registry for package metadata
2. Display package information
3. Show readme excerpt if available

#### Examples

```bash title="kintsu info"
# Show package info
kintsu info common-types

# Show specific version
kintsu info common-types@2.0.0

# List all versions
kintsu info --versions common-types

# Query specific registry
kintsu info --registry corp internal-types

# JSON output
kintsu info --json common-types
```

#### Output

**Default:**

```text title="kintsu info common-types" collapse={11-17}
common-types v2.4.0

  Common type definitions for Kintsu schemas

  Homepage:    https://github.com/kintsu/common-types
  Repository:  https://github.com/kintsu/common-types
  License:     MIT
  Published:   2025-01-15 (3 days ago)
  Downloads:   12,453 (last 30 days)

  Keywords: types, common, shared

  Dependencies:
    validation-core ^1.0

  README:
    # Common Types

    Shared type definitions for use across Kintsu schemas...
```

**Versions:**

```text title="kintsu info --versions common-types"
common-types

  Available versions:
    2.4.0    2025-01-15    (latest)
    2.3.1    2024-12-01
    2.3.0    2024-11-15
    2.2.0    2024-10-01
    2.1.0    2024-09-01
    2.0.0    2024-08-01
    ...

  Total: 24 versions
```

**JSON:**

```json title="kintsu info --json common-types"
{
  "name": "common-types",
  "version": "2.4.0",
  "description": "Common type definitions for Kintsu schemas",
  "license": "MIT",
  "homepage": "https://github.com/kintsu/common-types",
  "repository": "https://github.com/kintsu/common-types",
  "published": "2025-01-15T10:30:00Z",
  "downloads": {
    "last30days": 12453,
    "total": 156789
  },
  "keywords": ["types", "common", "shared"],
  "dependencies": {
    "validation-core": "^1.0"
  }
}
```

#### Error Conditions

| Condition               | Description                     |
| ----------------------- | ------------------------------- |
| Package not found       | No package with that name       |
| Version not found       | Specified version doesn't exist |
| Registry not configured | Unknown registry name           |
| Network error           | Registry unreachable            |

---

### kintsu tree

Displays the dependency tree.

#### Synopsis

```
kintsu tree [OPTIONS]
```

#### Options

| Option            | Short | Description                                      |
| ----------------- | ----- | ------------------------------------------------ |
| `--depth <N>`     | `-d`  | Maximum tree depth (default: unlimited)          |
| `--invert`        | `-i`  | Show reverse dependencies (what depends on what) |
| `--package <PKG>` | `-p`  | Focus on specific package                        |
| `--duplicates`    |       | Only show packages appearing multiple times      |
| `--json`          |       | Output in JSON format                            |
| `--workspace`     | `-w`  | Show workspace dependency graph                  |

#### Behaviour

1. Build dependency graph from lockfile
2. Render as ASCII tree
3. Highlight duplicates and conflicts

#### Examples

```bash title="kintsu tree"
# Show full dependency tree
kintsu tree

# Limit depth
kintsu tree --depth 2

# Focus on package
kintsu tree --package common-types

# Show what depends on a package
kintsu tree --invert --package common-types

# Show only duplicates
kintsu tree --duplicates

# Workspace graph
kintsu tree --workspace
```

#### Output

**Default:**

```text title="kintsu tree"
my-schema v1.0.0
 |--- common-types v2.3.1
|    |--- validation-core v1.2.0
|    |--- serde-utils v0.5.0
 |--- api-utils v1.2.0
|    |--- common-types v2.3.1 (*)
|    |--- http-types v3.0.0
 |--- internal-lib v0.9.0
     |--- common-types v2.3.1 (*)

(*) = deduplicated
```

**Inverted:**

```text title="kintsu tree --invert --package common-types"
common-types v2.3.1
 |--- my-schema v1.0.0
 |--- api-utils v1.2.0
|    |--- my-schema v1.0.0
 |--- internal-lib v0.9.0
     |--- my-schema v1.0.0
```

**Duplicates:**

```text title="kintsu tree --duplicates"
Packages appearing multiple times:

  common-types v2.3.1
     |--- my-schema (direct)
     |--- api-utils v1.2.0
     |--- internal-lib v0.9.0

  serde-utils v0.5.0
     |--- common-types v2.3.1
     |--- internal-lib v0.9.0
```

**Workspace:**

```text title="kintsu tree --workspace"
my-workspace
 |--- common v1.0.0
|    |--- external-types v2.1.0
 |--- api v1.2.0
|    |--- common v1.0.0 (workspace)
|    |--- validation v1.5.0
 |--- internal v0.9.0
     |--- common v1.0.0 (workspace)
     |--- api v1.2.0 (workspace)
```

**JSON:**

```json title="kintsu tree --json"
{
  "name": "my-schema",
  "version": "1.0.0",
  "dependencies": [
    {
      "name": "common-types",
      "version": "2.3.1",
      "dependencies": [
        {
          "name": "validation-core",
          "version": "1.2.0",
          "dependencies": []
        }
      ]
    }
  ]
}
```

#### Error Conditions

| Condition                               | Description                   |
| --------------------------------------- | ----------------------------- |
| No schema.toml found                    | Not in a package or workspace |
| No schema.lock.toml found               | Lockfile doesn't exist        |
| No workspace found (with `--workspace`) | Not in a workspace context    |

---

### kintsu inspect

Displays derived virtual manifests for workspace schemas.

#### Synopsis

```
kintsu inspect [OPTIONS]
```

#### Options

| Option            | Short | Description                             |
| ----------------- | ----- | --------------------------------------- |
| `--schema <NAME>` | `-s`  | Show specific schema's derived manifest |
| `--json`          |       | Output in JSON format                   |

#### Behaviour

1. Parse workspace manifest
2. Derive virtual manifests for each schema member
3. Display as TOML (or JSON with `--json`)

This command is only valid in workspace contexts.

#### Examples

```bash title="kintsu inspect"
# Show all schemas' derived manifests
kintsu inspect

# Show specific schema's derived manifest
kintsu inspect --schema api

# JSON output
kintsu inspect --json --schema api
```

#### Output

**All schemas (default):**

```text title="kintsu inspect" collapse={13-23}
Workspace: my-workspace

=== common (./common) ===

[package]
name = "common"
version = "1.0.0"

[dependencies]
external-types = "^2.0"

=== api (./packages/api) ===

[package]
name = "api"
version = "1.2.0"

[dependencies]
common = { path = "../common" }
external-types = "^2.0"
validation = "^1.5"
```

**Single schema:**

```toml title="kintsu inspect --schema api"
# Derived manifest for: api

[package]
name = "api"
version = "1.2.0"
description = "API schema definitions"

[dependencies]
common = { path = "../common" }
external-types = "^2.0"
validation = "^1.5"
```

**JSON:**

```json title="kintsu inspect --json --schema api"
{
  "package": {
    "name": "api",
    "version": "1.2.0",
    "description": "API schema definitions"
  },
  "dependencies": {
    "common": { "path": "../common" },
    "external-types": "^2.0",
    "validation": "^1.5"
  }
}
```

#### Error Conditions

| Condition        | Description                      |
| ---------------- | -------------------------------- |
| Not in workspace | Command only works in workspaces |
| Schema not found | Specified schema doesn't exist   |

---

## Common Behaviours

### Caching

Registry queries are cached:

| Data             | TTL        |
| ---------------- | ---------- |
| Package metadata | 1 hour     |
| Version list     | 15 minutes |
| Outdated check   | 5 minutes  |

Use `--no-cache` to bypass.

### Colourised Output

Output is colourised by default:

- Green: up-to-date versions
- Yellow: minor updates available
- Red: major updates or breaking changes
- Blue: workspace references
- Grey: deduplicated entries

Use `--no-color` or `NO_COLOR=1` to disable.

## Acceptance Criteria

### AC-1: List Basic

Given dependencies in schema.toml, when `kintsu list` runs, then dependencies must be displayed.

### AC-2: List Outdated

Given outdated dependencies, when `kintsu list --outdated` runs, then only outdated must be shown.

### AC-3: List Workspace

Given a workspace, when `kintsu list --workspace` runs, then all schemas must be listed.

### AC-4: Info Basic

Given a valid package name, when `kintsu info pkg` runs, then package details must be displayed.

### AC-5: Info Versions

Given `--versions` flag, when `kintsu info` runs, then all versions must be listed.

### AC-6: Tree Basic

Given a lockfile, when `kintsu tree` runs, then dependency tree must be displayed.

### AC-7: Tree Depth

Given `--depth 2`, when `kintsu tree` runs, then tree must be limited to 2 levels.

### AC-8: Tree Invert

Given `--invert`, when `kintsu tree` runs, then reverse dependencies must be shown.

### AC-9: Inspect All

Given a workspace, when `kintsu inspect` runs, then all derived manifests must be shown.

### AC-10: Inspect Single

Given `--schema api`, when `kintsu inspect` runs, then only api's derived manifest must be shown.

### AC-11: JSON Output

Given `--json` flag, when any command runs, then output must be valid JSON.

### AC-12: No Manifest Error

Given no schema.toml, when commands run, then appropriate error must be returned.

## References

- [RFC-0019](/specs/rfc/rfc-0019) - Package Manifest Format
- [RFC-0020](/specs/rfc/rfc-0020) - Lockfile Format
- [RFC-0024](/specs/rfc/rfc-0024) - Workspace Manifest Format
- [ERR-0011](/specs/err/err-0011) - Package Errors
- [ERR-0012](/specs/err/err-0012) - Registry Errors
