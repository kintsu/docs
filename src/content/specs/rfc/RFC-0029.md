---
author: joshua-auchincloss
components:
  - cli
created: 2025-12-26
kind: RFC
number: 29
status: draft
title: CLI Scaffolding Commands
updates:
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Removed git init (VCS outside kintsu domain), updated to [alias.package] format
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Consolidated init into new command
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Created specification
version_after: 0.1.0
version_before: null
---

# RFC-0029: CLI Scaffolding Commands

## Summary

This RFC specifies the `new` CLI command for creating schema projects and workspaces.

## Motivation

Developers need easy ways to:

- Create new schema packages from scratch
- Set up workspaces for multi-schema projects
- Add schemas to existing workspaces

The `new` command provides scaffolding with sensible defaults and optional customization.

## Specification

### kintsu new

Creates a new schema package or workspace.

#### Synopsis

```
kintsu new [OPTIONS] [NAME]
```

#### Arguments

| Argument | Description                                                                                 |
| -------- | ------------------------------------------------------------------------------------------- |
| `[NAME]` | Schema or workspace name. If omitted, uses current directory name and initializes in place. |

The special argument `workspace` creates a workspace instead of a package:

```bash title="kintsu new workspace"
kintsu new workspace         # Creates workspace in new "workspace" directory
kintsu new workspace myproj  # Creates workspace named "myproj"
```

#### Options

| Option              | Short | Description              |
| ------------------- | ----- | ------------------------ |
| `--lib`             |       | Create library structure |
| `--workspace`       | `-w`  | Create as workspace      |
| `--path <PATH>`     |       | Create at specific path  |
| `--template <NAME>` | `-t`  | Use template (see below) |

#### Behavior

##### Creating a Package (Default)

When creating a standard package:

1. **Directory creation** (if NAME provided)
   - Create directory with package name
   - If no NAME, initialize in current directory

2. **Manifest creation**
   - Create `schema.toml` with `version = "v1"` discriminator
   - Create `[package]` table with name, version
   - Set version to `0.1.0`

3. **Directory structure**
   - Create `schema/` directory
   - Create initial `lib.ks` file

##### Creating a Workspace

With `--workspace` or `kintsu new workspace`:

1. Create workspace `schema.toml` with `resolver = "v1"` discriminator
2. Create `[workspace]` table with name
3. Workspace is ready for package definitions

##### Adding Schema to Workspace

When running `kintsu new <name>` inside a workspace:

1. Create schema directory at workspace-relative path
2. Create `schema/lib.ks` in new directory
3. Add `[alias.package]` definition to workspace manifest
4. **No child schema.toml is created** - workspace manifest is authoritative

#### Templates

| Template    | Description                      |
| ----------- | -------------------------------- |
| `default`   | Standard schema with lib.ks      |
| `lib`       | Library package (no entry point) |
| `workspace` | Workspace with example schema    |

Custom templates can be added to `$KINTSU_HOME/templates/`.

#### Examples

```bash title="kintsu new"
# Create new package (creates my-types/ directory)
kintsu new my-types

# Initialize package in current directory
kintsu new

# Create at specific path
kintsu new my-types --path ./packages

# Create as library
kintsu new my-types --lib

# Create workspace
kintsu new --workspace my-workspace
kintsu new workspace             # Alternative syntax

# Use template
kintsu new my-api --template api

# Add schema to existing workspace (when inside workspace)
kintsu new common                # Adds [common.package] definition
```

#### Output

**Creating a Package:**

```text title="kintsu new my-types"
  Creating schema my-types...

    Created my-types/schema.toml
    Created my-types/schema/lib.ks

  ✓ Schema my-types created!

  Next steps:
    cd my-types
    kintsu check
```

**Creating a Workspace:**

```text title="kintsu new --workspace my-workspace"
  Creating workspace my-workspace...

    Created my-workspace/schema.toml (workspace)

  ✓ Workspace my-workspace created!

  Create your first schema:
    cd my-workspace
    kintsu new my-schema
```

**Adding Schema to Workspace:**

```text title="kintsu new common (in workspace)"
  Adding schema common to workspace...

    Created common/schema/lib.ks
    Updated schema.toml

  ✓ Schema common added to workspace!

  View virtual manifest:
    kintsu inspect --schema common
```

#### Generated Files

**schema.toml (package):**

```toml title="schema.toml (package)" collapse={6-10}
version = "v1"

[package]
name = "my-types"
version = "0.1.0"
edition = "2025"

# Uncomment to add package metadata
# description = "A Kintsu schema package"
# license = "MIT"
# repository = "https://github.com/user/my-types"
# keywords = ["types"]

[dependencies]
# common-types = "^1.0"
```

**schema.toml (workspace):**

```toml title="schema.toml (workspace)"
resolver = "v1"

[workspace]
name = "my-workspace"

# Add packages to the workspace using [alias.package] format:
# [my-schema.package]
# name = "my-schema"
# version = "0.1.0"
# path = "my-schema"

# Shared dependencies across all schemas
[workspace.dependencies]
# common-types = "^1.0"
```

**schema.toml (workspace with schema added):**

After running `kintsu new common` inside workspace:

```toml title="schema.toml (workspace with schema)"
resolver = "v1"

[workspace]
name = "my-workspace"

[common.package]
name = "common"
version = "0.1.0"
path = "common"

# Schema-specific dependencies
[common.dependencies]
# Add dependencies for common here

[workspace.dependencies]
# Shared dependencies across all schemas
```

**schema/lib.ks:**

```ks title="schema/lib.ks"
/// # my-types
///
/// A Kintsu schema package.

namespace my_types {
    /// An example struct.
    struct Example {
        /// A required string field.
        name: string,
    }
}
```

#### Errors

| Condition                             |
| ------------------------------------- |
| Directory already exists              |
| Invalid package name                  |
| Cannot create directory               |
| Template not found                    |
| schema.toml already exists (in-place) |
| Cannot write to directory             |

---

## Package Name Validation

Valid package names:

- Lowercase letters, numbers, hyphens
- Start with letter
- Minimum 2 characters
- Maximum 64 characters
- Match pattern: `^[a-z][a-z0-9-]*[a-z0-9]$`

Invalid names and suggestions:

| Invalid    | Issue              | Suggestion |
| ---------- | ------------------ | ---------- |
| `MyTypes`  | Uppercase          | `my-types` |
| `my_types` | Underscore         | `my-types` |
| `1types`   | Starts with number | `types-1`  |
| `a`        | Too short          | (error)    |
| `-types`   | Starts with hyphen | `my-types` |

## Directory Structure Options

### Standard Package

```text title="Standard package structure"
my-types/
 |--- schema.toml          # version = "v1"
 |--- schema/
     |--- lib.ks
```

### Library Package

```text title="Library package structure"
my-types/
 |--- schema.toml          # version = "v1"
 |--- schema/
     |--- lib.ks
     |--- types/
         |--- mod.ks
```

### Workspace (Empty)

```text title="Empty workspace structure"
my-workspace/
 |--- schema.toml          # resolver = "v1"
```

### Workspace with Schema

After `kintsu new common` in workspace:

```text title="Workspace with schema structure"
my-workspace/
 |--- schema.toml          # resolver = "v1", [common.package] definition
 |--- common/
     |--- schema/
         |--- lib.ks
```

Note: No `schema.toml` in child directories. The workspace manifest contains all schema configuration via `[alias.package]` definitions.

## Acceptance Criteria

### AC-1: New Creates Directory

Given `kintsu new my-types`, when run, then `my-types/` directory must be created with schema.toml.

### AC-2: New In Place

Given no NAME argument, when `kintsu new` runs in empty directory, then schema.toml must be created in current directory.

### AC-3: New Name Inference

Given `kintsu new` in directory `my-types`, when run, then package name must be `my-types`.

### AC-4: New Workspace Flag

Given `--workspace`, when `kintsu new` runs, then resolver field must be `v1`.

### AC-5: New Workspace Argument

Given `kintsu new workspace myproj`, when run, then workspace named `myproj` must be created.

### AC-6: New Exists

Given existing `my-types/`, when `kintsu new my-types` runs, then error must be returned.

### AC-7: New In Workspace

Given workspace context, when `kintsu new common` runs, then:

- `common/schema/lib.ks` must be created
- `[common.package]` definition must be added to workspace manifest
- No `common/schema.toml` must be created

### AC-8: Name Validation

Given invalid name `My_Types`, when creating schema, then error with suggestion must be returned.

### AC-9: Package Discriminator

Given `kintsu new my-types`, when creating package, then `version = "v1"` must be in schema.toml.

### AC-10: Workspace Discriminator

Given `kintsu new --workspace`, when creating workspace, then `resolver = "v1"` must be in schema.toml.

### AC-11: No Git Initialization

Given `kintsu new my-types`, when run, then git must NOT be initialized (VCS is outside kintsu's domain).

## References

- [RFC-0019](/specs/rfc/RFC-0019) - Package Manifest Format
- [RFC-0024](/specs/rfc/RFC-0024) - Workspace Manifest Format
- [ERR-0016](/specs/err/ERR-0016) - CLI Errors
