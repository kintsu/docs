---
author: joshua-auchincloss
components:
  - compiler
created: 2025-12-26
kind: ERR
number: 15
status: draft
title: Workspace Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Updated examples to align with virtual manifest model
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0015: Workspace Errors

## Overview

This specification defines the KWS (Kintsu WorkSpace) error domain, covering all errors related to workspace manifest parsing, schema discovery, and workspace resolution.

## Domain Summary

### Syntax Errors

| Code    | Name                   | Severity | Category |
| ------- | ---------------------- | -------- | -------- |
| KWS0001 | WorkspaceManifestParse | Error    | Syntax   |

### Resolution Errors

| Code    | Name                    | Severity | Category   |
| ------- | ----------------------- | -------- | ---------- |
| KWS1001 | SchemaDiscoveryFailed   | Error    | Resolution |
| KWS1002 | WorkspaceResolutionLoop | Error    | Resolution |

### Validation Errors

| Code    | Name                     | Severity | Category   |
| ------- | ------------------------ | -------- | ---------- |
| KWS2001 | InvalidWorkspaceConfig   | Error    | Validation |
| KWS2002 | NestedWorkspaceForbidden | Error    | Validation |
| KWS2003 | InvalidSchemaPath        | Error    | Validation |
| KWS2004 | DuplicateSchemaName      | Error    | Validation |

### Conflict Errors

| Code    | Name                  | Severity | Category |
| ------- | --------------------- | -------- | -------- |
| KWS3001 | SchemaVersionConflict | Error    | Conflict |

### Missing Errors

| Code    | Name                      | Severity | Category |
| ------- | ------------------------- | -------- | -------- |
| KWS4001 | WorkspaceManifestNotFound | Error    | Missing  |
| KWS4002 | SchemaDirectoryNotFound   | Error    | Missing  |
| KWS4003 | ReferencedSchemaNotFound  | Error    | Missing  |

---

## Error Definitions

### KWS0001: WorkspaceManifestParse

**Severity:** Error
**Phase:** Initialisation

**Message:**

```text title="KWS0001 message"
failed to parse workspace manifest: {reason}
```

**Primary Span:** The invalid line or token in the manifest

**Help:** Fix the TOML syntax error in your workspace `schema.toml`.

**Example:**

```text title="KWS0001 example"
error[KWS0001]: failed to parse workspace manifest: expected '=' after key
  --> schema.toml:3:12
   |
 3 | resolver "v1"
   |          ^ expected '='
   |
   = help: use `resolver = "v1"`
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS1001: SchemaDiscoveryFailed

**Severity:** Error
**Phase:** Workspace Resolution

**Message:**

```text title="KWS1001 message"
failed to discover schemas in workspace
```

**Primary Span:** N/A

**Help:** Check that schema directories exist and contain source files.

**Example:**

```text title="KWS1001 example"
error[KWS1001]: failed to discover schemas in workspace
   |
   = note: no schemas found matching workspace configuration
   = help: ensure each schema directory contains .ks source files
   = help: or add [alias.package] definitions in the workspace manifest
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS1002: WorkspaceResolutionLoop

**Severity:** Error
**Phase:** Workspace Resolution

**Message:**

```text title="KWS1002 message"
circular reference in workspace schema dependencies
```

**Primary Span:** The dependency causing the cycle

**Help:** Remove the circular dependency between workspace schemas.

**Example:**

```text title="KWS1002 example"
error[KWS1002]: circular reference in workspace schema dependencies
   |
   = note: api -> common -> types -> api
   = help: refactor to break the dependency cycle
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS2001: InvalidWorkspaceConfig

**Severity:** Error
**Phase:** Validation

**Message:**

```text title="KWS2001 message"
invalid workspace configuration: {reason}
```

**Primary Span:** The invalid configuration field

**Help:** Check the workspace manifest format.

**Example:**

```text title="KWS2001 example"
error[KWS2001]: invalid workspace configuration: unknown resolver version
  --> schema.toml:1:12
   |
 1 | resolver = "v2"
   |            ^^^^ unknown resolver version
   |
   = note: supported resolvers: "v1"
   = help: use `resolver = "v1"`
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS2002: NestedWorkspaceForbidden

**Severity:** Error
**Phase:** Validation

**Message:**

```text title="KWS2002 message"
nested workspaces are not allowed
```

**Primary Span:** The nested workspace manifest

**Help:** Workspaces must be flat; remove the nested workspace.

**Example:**

```text title="KWS2002 example"
error[KWS2002]: nested workspaces are not allowed
  --> packages/api/schema.toml:1:1
   |
 1 | resolver = "v1"
   | ^^^^^^^^^^^^^^^ nested workspace found
   |
   = note: workspace already defined in /path/to/schema.toml
   = help: remove the resolver field to make this a regular schema
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS2003: InvalidSchemaPath

**Severity:** Error
**Phase:** Validation

**Message:**

```text title="KWS2003 message"
invalid schema path '{path}': {reason}
```

**Primary Span:** The schema path configuration

**Help:** Schema paths must be relative directories within the workspace.

**Example:**

```text title="KWS2003 example"
error[KWS2003]: invalid schema path '../external/api': path escapes workspace root
  --> schema.toml:8:10
   |
 8 | path = "../external/api"
   |        ^^^^^^^^^^^^^^^^^ path escapes workspace
   |
   = help: all schemas must be within the workspace directory
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS2004: DuplicateSchemaName

**Severity:** Error
**Phase:** Validation

**Message:**

```text title="KWS2004 message"
duplicate schema name '{name}' in workspace
```

**Primary Span:** The duplicate schema entry

**Help:** Each schema in a workspace must have a unique name.

**Example:**

```text title="KWS2004 example"
error[KWS2004]: duplicate schema name 'common' in workspace
  --> schema.toml:12:1
   |
 5 | [common.package]
 6 | name = "common"
   |        -------- first declaration
   |
12 | [shared.package]
13 | name = "common"
   |        ^^^^^^^^ duplicate package name
   |
   = help: rename one of the packages
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS3001: SchemaVersionConflict

**Severity:** Error
**Phase:** Workspace Resolution

**Message:**

```text title="KWS3001 message"
version conflict between workspace schemas for dependency '{name}'
```

**Primary Span:** The conflicting dependency declarations

**Help:** Ensure workspace schemas use compatible dependency versions.

**Example:**

```text title="KWS3001 example"
error[KWS3001]: version conflict between workspace schemas for dependency 'external-types'
   |
   = note: api requires ^1.0, common requires ^2.0
   = help: use [workspace.dependencies] to declare shared version constraints
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS4001: WorkspaceManifestNotFound

**Severity:** Error
**Phase:** Initialisation

**Message:**

```text title="KWS4001 message"
workspace manifest not found
```

**Primary Span:** N/A

**Help:** Create a workspace manifest with `resolver = "v1"`.

**Example:**

```text title="KWS4001 example"
error[KWS4001]: workspace manifest not found
   |
   = note: no schema.toml with resolver field found in parent directories
   = help: create a schema.toml with `resolver = "v1"` at the workspace root
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS4002: SchemaDirectoryNotFound

**Severity:** Error
**Phase:** Workspace Resolution

**Message:**

```text title="KWS4002 message"
schema directory not found: '{path}'
```

**Primary Span:** The schema path configuration

**Help:** Create the directory or update the path.

**Example:**

```text title="KWS4002 example"
error[KWS4002]: schema directory not found: 'packages/api'
  --> schema.toml:6:10
   |
 6 | path = "packages/api"
   |        ^^^^^^^^^^^^^^ directory not found
   |
   = help: create the directory or update the path
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

### KWS4003: ReferencedSchemaNotFound

**Severity:** Error
**Phase:** Workspace Resolution

**Message:**

```text title="KWS4003 message"
referenced workspace schema not found: '{name}'
```

**Primary Span:** The schema reference

**Help:** Check the schema name or add it to the workspace.

**Example:**

```text title="KWS4003 example"
error[KWS4003]: referenced workspace schema not found: 'shared-types'
  --> schema.toml:15:1
   |
15 | shared-types = { workspace = true }
   | ^^^^^^^^^^^^ schema not in workspace
   |
   = help: add a [shared-types.package] definition to the workspace or check the name
```

**References:** [RFC-0024](/specs/rfc/RFC-0024) (Workspace Manifest Format)

---

## References

- [RFC-0024](/specs/rfc/RFC-0024) - Workspace Manifest Format
- [RFC-0019](/specs/rfc/RFC-0019) - Package Manifest Format
- [ERR-0001](/specs/err/ERR-0001) - Error System Overview
