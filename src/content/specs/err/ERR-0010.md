---
author: joshua-auchincloss
components:
  - compiler
created: 2025-12-25
kind: ERR
number: 10
status: draft
title: Type Expression Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-25
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0010: Type Expression Errors

## Overview

This specification defines the KTE (Kintsu Type Expression) error domain, covering all errors related to type expression operators (`Pick`, `Omit`, `Partial`, `Required`, `Extract`, `Exclude`, `ArrayItem`) and field access projections.

## Domain Summary

### Parsing Errors

| Code    | Name               | Severity | Category |
| ------- | ------------------ | -------- | -------- |
| KTE0001 | MissingOpenBracket | Error    | Syntax   |
| KTE0002 | UnclosedBracket    | Error    | Syntax   |
| KTE0003 | InvalidSelector    | Error    | Syntax   |
| KTE0004 | MissingSeparator   | Error    | Syntax   |

### Type Mismatch Errors

| Code    | Name                     | Severity | Category   |
| ------- | ------------------------ | -------- | ---------- |
| KTE2001 | ExpectedStructType       | Error    | Validation |
| KTE2002 | ExpectedOneofType        | Error    | Validation |
| KTE2003 | ExpectedArrayType        | Error    | Validation |
| KTE2004 | CannotAccessFieldsOnType | Error    | Validation |

### Resolution Errors

| Code    | Name                 | Severity | Category   |
| ------- | -------------------- | -------- | ---------- |
| KTE1001 | UnknownField         | Error    | Resolution |
| KTE1002 | UnknownVariant       | Error    | Resolution |
| KTE4001 | EmptySelectorList    | Error    | Missing    |
| KTE4002 | NoFieldsRemain       | Error    | Missing    |
| KTE4003 | NoVariantsRemain     | Error    | Missing    |
| KTE5001 | CyclicTypeExpression | Error    | Cycle      |

### Warnings

| Code    | Name                     | Severity | Category |
| ------- | ------------------------ | -------- | -------- |
| KTE8001 | DuplicateSelectorIgnored | Warning  | Warning  |
| KTE8002 | RedundantPartial         | Warning  | Warning  |
| KTE8003 | RedundantRequired        | Warning  | Warning  |

---

## Error Definitions

### KTE0001: MissingOpenBracket

**Severity:** Error
**Phase:** Parsing

**Message:**

```
expected '[' after operator name
```

**Primary Span:** The operator keyword

**Help:** Type expression operators require bracket syntax: `Pick[Type, fields]`.

**Example:**

```
error[KTE0001]: expected '[' after operator name
  --> schema/models.ks:1:5
   |
 1 | type T = Pick User, id;
   |          ^^^^ expected '[' here
   |
   = help: use bracket syntax: `Pick[User, id]`
```

---

### KTE0002: UnclosedBracket

**Severity:** Error
**Phase:** Parsing

**Message:**

```
expected ']' to close operator
```

**Primary Span:** The opening bracket or end of expression

**Help:** Close the type expression with `]`.

**Example:**

```
error[KTE0002]: expected ']' to close operator
  --> schema/models.ks:1:25
   |
 1 | type T = Pick[User, id | name
   |                              ^ expected ']'
   |
   = help: close the expression: `Pick[User, id | name]`
```

---

### KTE0003: InvalidSelector

**Severity:** Error
**Phase:** Parsing

**Message:**

```
expected identifier in selector list
```

**Primary Span:** The invalid token

**Help:** Selectors must be valid identifiers (field or variant names).

**Example:**

```
error[KTE0003]: expected identifier in selector list
  --> schema/models.ks:1:18
   |
 1 | type T = Pick[User, 123];
   |                     ^^^ expected identifier
   |
   = help: use field names: `Pick[User, id | name]`
```

---

### KTE0004: MissingSeparator

**Severity:** Error
**Phase:** Parsing

**Message:**

```
expected ',' between target and selectors
```

**Primary Span:** Between target type and selector list

**Help:** Separate the target type from selectors with a comma.

**Example:**

```
error[KTE0004]: expected ',' between target and selectors
  --> schema/models.ks:1:17
   |
 1 | type T = Pick[User id];
   |                    ^ expected ','
   |
   = help: use: `Pick[User, id]`
```

---

### KTE2001: ExpectedStructType

**Severity:** Error
**Phase:** Validation

**Message:**

```
expected struct type, found {type}
```

**Primary Span:** The target type

**Help:** `Pick`, `Omit`, `Partial`, and `Required` operators require a struct type as their target.

**Example:**

```
error[KTE2001]: expected struct type, found scalar type 'i32'
  --> schema/models.ks:1:14
   |
 1 | type T = Pick[i32, x];
   |               ^^^ expected struct type
   |
   = help: struct operators require a struct target
```

---

### KTE2002: ExpectedOneofType

**Severity:** Error
**Phase:** Validation

**Message:**

```
expected oneof type, found {type}
```

**Primary Span:** The target type

**Help:** `Extract` and `Exclude` operators require a oneof type as their target.

**Example:**

```
error[KTE2002]: expected oneof type, found struct type 'User'
  --> schema/models.ks:1:17
   |
 1 | type T = Exclude[User, Admin];
   |                  ^^^^ expected oneof type
   |
   = help: oneof operators require a oneof target
```

---

### KTE2003: ExpectedArrayType

**Severity:** Error
**Phase:** Validation

**Message:**

```
expected array type, found {type}
```

**Primary Span:** The target type

**Help:** `ArrayItem` operator requires an array type as its target.

**Example:**

```
error[KTE2003]: expected array type, found struct type 'User'
  --> schema/models.ks:1:19
   |
 1 | type T = ArrayItem[User];
   |                    ^^^^ expected array type
   |
   = help: use ArrayItem on array types: `ArrayItem[User[]]`
```

---

### KTE2004: CannotAccessFieldsOnType

**Severity:** Error
**Phase:** Validation

**Message:**

```
cannot access fields on {type}
```

**Primary Span:** The type before the `::` accessor

**Help:** Field access (`::`) requires a struct type.

**Example:**

```
error[KTE2004]: cannot access fields on scalar type 'i32'
  --> schema/models.ks:1:10
   |
 1 | type T = i32::field;
   |          ^^^ cannot access fields
   |
   = help: field access requires a struct type
```

---

### KTE1001: UnknownField

**Severity:** Error
**Phase:** Resolution

**Message:**

```
field '{name}' not found in struct '{struct}'
```

**Primary Span:** The unknown field selector

**Help:** Check spelling or verify the field exists in the target struct.

**Example:**

```
error[KTE1001]: field 'nonexistent' not found in struct 'User'
  --> schema/models.ks:1:20
   |
 1 | type T = Pick[User, nonexistent];
   |                     ^^^^^^^^^^^ unknown field
   |
   = help: available fields: id, name, email
```

---

### KTE1002: UnknownVariant

**Severity:** Error
**Phase:** Resolution

**Message:**

```
variant '{name}' not found in oneof '{oneof}'
```

**Primary Span:** The unknown variant selector

**Help:** Check spelling or verify the variant exists in the target oneof.

**Example:**

```
error[KTE1002]: variant 'UnknownError' not found in oneof 'Response'
  --> schema/models.ks:1:25
   |
 1 | type T = Exclude[Response, UnknownError];
   |                            ^^^^^^^^^^^^ unknown variant
   |
   = help: available variants: Success, NotFound, ServerError
```

---

### KTE4001: EmptySelectorList

**Severity:** Error
**Phase:** Validation

**Message:**

```
empty selector list not allowed
```

**Primary Span:** The empty selector position

**Help:** Provide at least one field or variant selector.

**Example:**

```
error[KTE4001]: empty selector list not allowed
  --> schema/models.ks:1:19
   |
 1 | type T = Pick[User, ];
   |                     ^ expected at least one selector
   |
   = help: specify fields: `Pick[User, id | name]`
```

---

### KTE4002: NoFieldsRemain

**Severity:** Error
**Phase:** Validation

**Message:**

```
no fields remain after omitting all fields
```

**Primary Span:** The Omit expression

**Help:** The Omit selector removes all fields, leaving an empty struct. Remove some fields from the selector.

**Example:**

```
error[KTE4002]: no fields remain after omitting all fields
  --> schema/models.ks:1:10
   |
 1 | type T = Omit[User, id | name | email];
   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ all fields omitted
   |
   = help: keep at least one field
```

---

### KTE4003: NoVariantsRemain

**Severity:** Error
**Phase:** Validation

**Message:**

```
no variants remain after excluding all variants
```

**Primary Span:** The Exclude expression

**Help:** The Exclude selector removes all variants, leaving an empty oneof. Remove some variants from the selector.

**Example:**

```
error[KTE4003]: no variants remain after excluding all variants
  --> schema/models.ks:1:10
   |
 1 | type T = Exclude[Response, Success | Error];
   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ all variants excluded
   |
   = help: keep at least one variant
```

---

### KTE5001: CyclicTypeExpression

**Severity:** Error
**Phase:** Resolution

**Message:**

```
cyclic type expression detected
```

**Primary Span:** The self-referential type expression

**Help:** Type expressions cannot reference themselves. Break the cycle.

**Example:**

```
error[KTE5001]: cyclic type expression detected
  --> schema/models.ks:1:10
   |
 1 | type T = Pick[T, id];
   |          ^^^^^^^^^^^ self-reference creates cycle
   |
   = help: type expressions cannot be self-referential
```

---

### KTE8001: DuplicateSelectorIgnored

**Severity:** Warning
**Phase:** Validation

**Message:**

```
duplicate selector '{name}' ignored
```

**Primary Span:** The duplicate selector

**Help:** The selector appears multiple times. Only the first occurrence is used.

**Example:**

```
warning[KTE8001]: duplicate selector 'id' ignored
  --> schema/models.ks:1:32
   |
 1 | type T = Pick[User, id | name | id];
   |                                 ^^ duplicate selector
   |
   = note: first occurrence at column 22
```

---

### KTE8002: RedundantPartial

**Severity:** Warning
**Phase:** Validation

**Message:**

```
Partial has no effect on already-optional field '{name}'
```

**Primary Span:** The Partial expression or field

**Help:** The field is already optional. Partial has no effect.

**Example:**

```
warning[KTE8002]: Partial has no effect on already-optional field 'nickname'
  --> schema/models.ks:1:10
   |
 1 | type T = Partial[User, nickname];
   |          ^^^^^^^^^^^^^^^^^^^^^^^ redundant for optional field
   |
   = note: 'nickname' is already optional in User
```

---

### KTE8003: RedundantRequired

**Severity:** Warning
**Phase:** Validation

**Message:**

```
Required has no effect on already-required field '{name}'
```

**Primary Span:** The Required expression or field

**Help:** The field is already required. Required has no effect.

**Example:**

```
warning[KTE8003]: Required has no effect on already-required field 'id'
  --> schema/models.ks:1:10
   |
 1 | type T = Required[OptionalUser, id];
   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^ redundant for required field
   |
   = note: 'id' is already required in OptionalUser
```

---

## References

- [RFC-0023](/specs/rfc/rfc-0023) - Error Handling Design
- [SPEC-0022](/specs/spec/spec-0022) - Error System Architecture
- [ERR-0001](/specs/err/err-0001) - Error System Overview
- [TSY-0014](/specs/tsy/tsy-0014) - Type Expression Rules
- [SPEC-0017](/specs/spec/spec-0017) - Type Expression Compilation
