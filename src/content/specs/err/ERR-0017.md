---
author: joshua-auchincloss
components:
  - compiler
  - registry
created: 2025-12-27
kind: ERR
number: 17
status: draft
title: Compatibility Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-27
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0017: Compatibility Errors

## Overview

This specification defines the KCP (Kintsu Compatibility) error domain, covering all errors related to semver enforcement, pre-release dependency rules, and version compatibility validation during compilation and publishing.

## Domain Summary

### Dependency Errors

| Code    | Name                      | Severity | Category   |
| ------- | ------------------------- | -------- | ---------- |
| KCP1001 | PreReleaseDepFromReleased | Error    | Dependency |
| KCP1002 | ReleasedDepFromPreRelease | Error    | Dependency |

### Patch Version Errors

| Code    | Name                  | Severity | Category |
| ------- | --------------------- | -------- | -------- |
| KCP2001 | PatchStructuralChange | Error    | Patch    |
| KCP2002 | PatchTypeChange       | Error    | Patch    |
| KCP2003 | PatchNewType          | Error    | Patch    |
| KCP2004 | PatchFieldAddition    | Error    | Patch    |
| KCP2005 | PatchFieldRemoval     | Error    | Patch    |

### Minor Version Errors

| Code    | Name                | Severity | Category |
| ------- | ------------------- | -------- | -------- |
| KCP3001 | MinorRequiredField  | Error    | Minor    |
| KCP3002 | MinorRemoval        | Error    | Minor    |
| KCP3003 | MinorRename         | Error    | Minor    |
| KCP3004 | MinorTypeChange     | Error    | Minor    |
| KCP3005 | MinorEnumVariant    | Error    | Minor    |
| KCP3006 | MinorOneOfVariant   | Error    | Minor    |
| KCP3007 | MinorTagChange      | Error    | Minor    |
| KCP3008 | MinorOptionalChange | Error    | Minor    |

### Type Chain Errors

| Code    | Name              | Severity | Category |
| ------- | ----------------- | -------- | -------- |
| KCP4001 | TypeChainMismatch | Error    | Chain    |

---

## Error Definitions

### KCP1001: PreReleaseDepFromReleased

**Severity:** Error
**Phase:** Resolution / Publishing

**Message:**

```
released schema cannot depend on pre-release schema
```

**Primary Span:** The dependency declaration in `schema.toml`

**Related Spans:** None

**Help:** Released schemas (`â‰¥1.0.0`) can only depend on other released schemas. Either wait for the dependency to release `1.0.0`, or keep your schema in pre-release.

**Example:**

```
error[KCP1001]: released schema cannot depend on pre-release schema
  --> schema.toml:8:1
   |
 2 | version = "1.0.0"
   | ----------------- this schema is released
   |
 8 | experimental-types = "^0.5"
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^ depends on pre-release schema
   |
   = note: pre-release schemas (0.x.y) have no stability guarantees
   = help: wait for experimental-types to publish 1.0.0, or use version = "0.x.y" for your schema
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP1002: ReleasedDepFromPreRelease

**Severity:** Error
**Phase:** Resolution / Publishing

**Message:**

```
pre-release schema cannot depend on released schema
```

**Primary Span:** The dependency declaration in `schema.toml`

**Related Spans:** None

**Help:** Pre-release schemas (`0.x.y`) can only depend on other pre-release schemas. This prevents released schemas from being pulled into unstable dependency chains.

**Example:**

```
error[KCP1002]: pre-release schema cannot depend on released schema
  --> schema.toml:8:1
   |
 2 | version = "0.1.0"
   | ----------------- this schema is pre-release
   |
 8 | stable-types = "^2.0"
   | ^^^^^^^^^^^^^^^^^^^^^ depends on released schema
   |
   = note: mixing pre-release and released schemas creates unstable dependency chains
   = help: either upgrade to 1.0.0 or use a pre-release version of stable-types
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP2001: PatchStructuralChange

**Severity:** Error
**Phase:** Publishing

**Message:**

```
structural change not allowed in patch version
```

**Primary Span:** The changed declaration

**Related Spans:** The original declaration in the previous version

**Help:** Patch versions (`x.y.Z`) only allow documentation changes. Any structural modification requires at least a minor version bump.

**Example:**

```
error[KCP2001]: structural change not allowed in patch version
  --> schema/types.ks:5:5
   |
   = note: comparing 1.0.0 -> 1.0.1
   |
 5 |     email?: str,
   |     ^^^^^^^^^^^ field optionality changed
   |
   = help: documentation-only changes are allowed in patch versions
   = help: bump to 1.1.0 for structural changes
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP2002: PatchTypeChange

**Severity:** Error
**Phase:** Publishing

**Message:**

```
type change not allowed in patch version
```

**Primary Span:** The field or type with changed type

**Related Spans:** The original type in the previous version

**Help:** Patch versions only allow documentation changes. Type changes require a major version bump.

**Example:**

```
error[KCP2002]: type change not allowed in patch version
  --> schema/types.ks:3:5
   |
   = note: comparing 1.0.0 -> 1.0.1
   |
 3 |     id: i64,
   |     ^^^^^^^ was `i32` in 1.0.0
   |
   = help: type changes require a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP2003: PatchNewType

**Severity:** Error
**Phase:** Publishing

**Message:**

```
new type not allowed in patch version
```

**Primary Span:** The new type declaration

**Related Spans:** None

**Help:** Patch versions only allow documentation changes. New types require a minor version bump.

**Example:**

```
error[KCP2003]: new type not allowed in patch version
  --> schema/types.ks:10:1
   |
   = note: comparing 1.0.0 -> 1.0.1
   |
10 | struct NewType {
   | ^^^^^^^^^^^^^^ type did not exist in 1.0.0
   |
   = help: new types require a minor version bump (1.1.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP2004: PatchFieldAddition

**Severity:** Error
**Phase:** Publishing

**Message:**

```
field addition not allowed in patch version
```

**Primary Span:** The new field declaration

**Related Spans:** None

**Help:** Patch versions only allow documentation changes. Adding fields requires a minor version bump (optional fields) or major version bump (required fields).

**Example:**

```
error[KCP2004]: field addition not allowed in patch version
  --> schema/types.ks:5:5
   |
   = note: comparing 1.0.0 -> 1.0.1
   |
 5 |     email?: str,
   |     ^^^^^^^^^^^ field did not exist in 1.0.0
   |
   = help: optional field additions require a minor version bump (1.1.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP2005: PatchFieldRemoval

**Severity:** Error
**Phase:** Publishing

**Message:**

```
field removal not allowed in patch version
```

**Primary Span:** The location where the field was removed (struct declaration)

**Related Spans:** The field in the previous version

**Help:** Patch versions only allow documentation changes. Removing fields requires a major version bump.

**Example:**

```
error[KCP2005]: field removal not allowed in patch version
  --> schema/types.ks:1:1
   |
   = note: comparing 1.0.0 -> 1.0.1
   |
 1 | struct User {
   | ^^^^^^^^^^^ field `legacy_id` was removed
   |
   = note: field existed at schema/types.ks:4:5 in version 1.0.0
   = help: field removal requires a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3001: MinorRequiredField

**Severity:** Error
**Phase:** Publishing

**Message:**

```
required field addition not allowed in minor version
```

**Primary Span:** The new required field declaration

**Related Spans:** None

**Help:** Minor versions allow only optional field additions. Adding a required field is write-breaking (producers must provide the value) and requires a major version bump.

**Example:**

```
error[KCP3001]: required field addition not allowed in minor version
  --> schema/types.ks:5:5
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 5 |     created_at: datetime,
   |     ^^^^^^^^^^^^^^^^^^^^ required field added
   |
   = note: required fields break existing producers that don't provide the value
   = help: either make this field optional: `created_at?: datetime`
   = help: or bump to major version (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3002: MinorRemoval

**Severity:** Error
**Phase:** Publishing

**Message:**

```
removal not allowed in minor version
```

**Primary Span:** The location where the item was removed

**Related Spans:** The item in the previous version

**Help:** Minor versions do not allow removals. Removing types, fields, variants, or operations is breaking and requires a major version bump.

**Example:**

```
error[KCP3002]: removal not allowed in minor version
  --> schema/types.ks:1:1
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 1 | struct User {
   | ^^^^^^^^^^^ field `temp_flag` was removed
   |
   = note: existing consumers may expect this field to exist
   = help: removal requires a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3003: MinorRename

**Severity:** Error
**Phase:** Publishing

**Message:**

```
rename not allowed in minor version
```

**Primary Span:** The renamed item

**Related Spans:** The original name in the previous version

**Help:** Minor versions do not allow renames. Renaming changes wire format and breaks code generation. Use a major version bump.

**Example:**

```
error[KCP3003]: rename not allowed in minor version
  --> schema/types.ks:3:5
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 3 |     user_name: str,
   |     ^^^^^^^^^ was `name` in 1.0.0
   |
   = note: renames break wire format and generated code
   = help: rename requires a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3004: MinorTypeChange

**Severity:** Error
**Phase:** Publishing

**Message:**

```
type change not allowed in minor version
```

**Primary Span:** The field or type with changed type

**Related Spans:** The original type in the previous version

**Help:** Minor versions do not allow type changes. Even widening changes (e.g., `i32` -> `i64`) can cause integer overflow on constrained platforms. Use a major version bump.

**Example:**

```
error[KCP3004]: type change not allowed in minor version
  --> schema/types.ks:3:5
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 3 |     id: i64,
   |     ^^^^^^^ was `i32` in 1.0.0
   |
   = note: type widening can cause integer overflow on 32-bit platforms
   = note: type narrowing can cause data truncation
   = help: type changes require a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3005: MinorEnumVariant

**Severity:** Error
**Phase:** Publishing

**Message:**

```
enum variant addition not allowed in minor version
```

**Primary Span:** The new enum variant

**Related Spans:** None

**Help:** Minor versions do not allow adding enum variants. New variants break exhaustive match patterns in consuming code. Use a major version bump.

**Example:**

```
error[KCP3005]: enum variant addition not allowed in minor version
  --> schema/types.ks:5:5
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 5 |     Pending = 2,
   |     ^^^^^^^^^^^ variant did not exist in 1.0.0
   |
   = note: new variants break exhaustive match patterns
   = help: variant addition requires a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3006: MinorOneOfVariant

**Severity:** Error
**Phase:** Publishing

**Message:**

```
oneof variant addition not allowed in minor version
```

**Primary Span:** The new oneof variant

**Related Spans:** None

**Help:** Minor versions do not allow adding oneof variants. New variants break exhaustive match patterns in consuming code. Use a major version bump.

**Example:**

```
error[KCP3006]: oneof variant addition not allowed in minor version
  --> schema/types.ks:3:1
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 3 | type Response = oneof Success | Error | Timeout;
   |                                         ^^^^^^^ variant did not exist in 1.0.0
   |
   = note: new variants break exhaustive match patterns
   = help: variant addition requires a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3007: MinorTagChange

**Severity:** Error
**Phase:** Publishing

**Message:**

```
discriminant tag change not allowed in minor version
```

**Primary Span:** The type with changed tag

**Related Spans:** The original tag in the previous version

**Help:** Minor versions do not allow discriminant tag changes. Tag changes break wire format. Use a major version bump.

**Example:**

```
error[KCP3007]: discriminant tag change not allowed in minor version
  --> schema/types.ks:3:1
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 3 | @tag("kind")
   | ^^^^^^^^^^^^ was `@tag("type")` in 1.0.0
   |
   = note: discriminant tags are part of wire format
   = help: tag changes require a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP3008: MinorOptionalChange

**Severity:** Error
**Phase:** Publishing

**Message:**

```
optionality change not allowed in minor version
```

**Primary Span:** The field with changed optionality

**Related Spans:** The original declaration in the previous version

**Help:** Minor versions do not allow optionality changes. Making a field required is write-breaking; making it optional is a semantic change. Use a major version bump.

**Example:**

```
error[KCP3008]: optionality change not allowed in minor version
  --> schema/types.ks:4:5
   |
   = note: comparing 1.0.0 -> 1.1.0
   |
 4 |     email: str,
   |     ^^^^^^^^^^ was optional (`email?: str`) in 1.0.0
   |
   = note: making optional fields required breaks existing producers
   = help: optionality changes require a major version bump (2.0.0)
```

**References:** [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

### KCP4001: TypeChainMismatch

**Severity:** Error
**Phase:** Publishing

**Message:**

```
intermediate alias changes underlying type
```

**Primary Span:** The modified type alias

**Related Spans:** The alias chain resolution

**Help:** When inserting an intermediate type alias in a patch version, the underlying type must remain unchanged. If the resolved type differs, this is a breaking change.

**Example:**

```
error[KCP4001]: intermediate alias changes underlying type
  --> schema/types.ks:1:1
   |
   = note: comparing 1.0.0 -> 1.0.1
   |
 1 | type UserId = i64;
   | ^^^^^^^^^^^^^^^^^^ resolves to `i64`
   |
   = note: in 1.0.0, User::id resolved directly to `i32`
   = note: chain: User::id -> UserId -> i64 (was: User::id -> i32)
   = help: underlying type changes require a major version bump (2.0.0)
```

**References:** [RFC-0030](/specs/rfc/rfc-0030) (Type Introspection), [RFC-0031](/specs/rfc/rfc-0031) (Versioning Guarantees)

---

## References

- [RFC-0030](/specs/rfc/rfc-0030) - Type Introspection
- [RFC-0031](/specs/rfc/rfc-0031) - Versioning Guarantees
- [ERR-0001](/specs/err/err-0001) - Error Domains Overview
