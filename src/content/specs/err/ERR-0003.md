---
author: joshua-auchincloss
components:
  - parser
created: 2025-12-25
kind: ERR
number: 3
status: draft
title: Parsing Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-25
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0003: Parsing Errors (KPR)

## Overview

This specification defines all error codes in the **Parsing (KPR)** domain. Parsing errors occur when the token stream cannot be transformed into a valid AST. These errors indicate structural problems with the source code syntax.

**Domain Code:** `PR`
**Phase:** Parsing
**Span Required:** Yes (token-level precision)

## Error Code Registry

| Code    | Name                    | Severity | Category   |
| ------- | ----------------------- | -------- | ---------- |
| KPR0001 | UnexpectedToken         | Error    | Syntax     |
| KPR0002 | UnexpectedEndOfFile     | Error    | Syntax     |
| KPR0003 | ExpectedOneOf           | Error    | Syntax     |
| KPR0004 | InvalidPath             | Error    | Syntax     |
| KPR0005 | UnknownAttribute        | Error    | Syntax     |
| KPR0006 | MissingLibKs            | Error    | Missing    |
| KPR0007 | LibKsMultiSegmentImport | Error    | Validation |
| KPR0008 | LibKsInvalidItem        | Error    | Validation |
| KPR0009 | LibKsMissingNamespace   | Error    | Missing    |
| KPR0010 | EmptyFileList           | Error    | Missing    |

## Error Definitions

### KPR0001: UnexpectedToken

**Severity:** Error
**Phase:** Parsing

**Message:**

```
expected {expected}, found {found}
```

**Primary Span:** The unexpected token

**Help:** Check the syntax at this location. The parser expected a different token type.

**Example:**

```
error[KPR0001]: expected '{', found 'name'
  --> schema/types.ks:3:8
   |
 3 | struct User name: str }
   |             ^^^^ expected '{'
   |
   = help: add '{' before field declarations
```

---

### KPR0002: UnexpectedEndOfFile

**Severity:** Error
**Phase:** Parsing

**Message:**

```
expected {expected}, found end of file
```

**Primary Span:** End of file position

**Help:** The file ended unexpectedly. Check for unclosed braces or incomplete declarations.

**Example:**

```
error[KPR0002]: expected '}', found end of file
  --> schema/types.ks:5:1
   |
 3 | struct User {
 4 |     name: str,
 5 |
   | ^ expected '}'
   |
   = help: add '}' to close the struct declaration
```

---

### KPR0003: ExpectedOneOf

**Severity:** Error
**Phase:** Parsing

**Message:**

```
expected one of {alternatives}, found {found}
```

**Primary Span:** The unexpected token

**Help:** The parser expected one of several valid alternatives at this position.

**Example:**

```
error[KPR0003]: expected one of 'struct', 'enum', 'error', 'oneof', found 'class'
  --> schema/types.ks:3:1
   |
 3 | class User {
   | ^^^^^ expected type declaration keyword
   |
   = help: use 'struct' to define a data type
```

---

### KPR0004: InvalidPath

**Severity:** Error
**Phase:** Parsing

**Message:**

```
invalid path '{path}': {reason}
```

**Primary Span:** The malformed path

**Help:** Type paths must use `::` separators and valid identifiers.

**Example:**

```
error[KPR0004]: invalid path 'foo..bar': consecutive separators
  --> schema/types.ks:5:12
   |
 5 |     user: foo..bar::User,
   |           ^^^^^^^^^^^^^^ invalid path syntax
   |
   = help: use single '::' between path segments
```

---

### KPR0005: UnknownAttribute

**Severity:** Error
**Phase:** Parsing

**Message:**

```
unknown attribute '{name}', expected one of {valid}
```

**Primary Span:** The unknown attribute name

**Help:** Check the attribute spelling. Valid attributes depend on context.

**Suggestions:** Generate from valid attribute names for the context.

**Example:**

```
error[KPR0005]: unknown attribute 'ver', expected one of 'version', 'err', 'tag', 'rename'
  --> schema/types.ks:2:3
   |
 2 | #[ver(1)]
   |   ^^^ unknown attribute
   |
   = help: did you mean 'version'?
```

---

### KPR0006: MissingLibKs

**Severity:** Error
**Phase:** Parsing

**Message:**

```
missing lib.ks: every schema must have a schema/lib.ks file
```

**Primary Span:** None (project-level error)

**Help:** Create a `schema/lib.ks` file with a namespace declaration and use statements for exposed namespaces.

**Example:**

```
error[KPR0006]: missing lib.ks: every schema must have a schema/lib.ks file
   |
   = help: create schema/lib.ks with:
           namespace my_schema;
           use types;
```

---

### KPR0007: LibKsMultiSegmentImport

**Severity:** Error
**Phase:** Parsing

**Message:**

```
lib.ks should only contain single-segment use statements
```

**Primary Span:** The multi-segment use statement

**Help:** In `lib.ks`, use statements expose local namespaces. Use single identifiers like `use types;` not `use foo::bar;`.

**Example:**

```
error[KPR0007]: lib.ks should only contain single-segment use statements
  --> schema/lib.ks:3:1
   |
 3 | use foo::bar;
   | ^^^^^^^^^^^^^ multi-segment path not allowed
   |
   = help: use 'use bar;' to expose the 'bar' namespace
```

---

### KPR0008: LibKsInvalidItem

**Severity:** Error
**Phase:** Parsing

**Message:**

```
lib.ks should only contain namespace declaration and use statements
```

**Primary Span:** The invalid item

**Help:** Type definitions belong in other files. `lib.ks` only declares the root namespace and exposed namespaces.

**Example:**

```
error[KPR0008]: lib.ks should only contain namespace declaration and use statements
  --> schema/lib.ks:5:1
   |
 5 | struct User {
   | ^^^^^^^^^^^^ type definition not allowed in lib.ks
   |
   = help: move type definitions to schema/types.ks or another file
```

---

### KPR0009: LibKsMissingNamespace

**Severity:** Error
**Phase:** Parsing

**Message:**

```
lib.ks must contain a namespace declaration
```

**Primary Span:** Start of file

**Help:** Add a namespace declaration at the top of `lib.ks`.

**Example:**

```
error[KPR0009]: lib.ks must contain a namespace declaration
  --> schema/lib.ks:1:1
   |
 1 | use types;
   | ^ expected 'namespace' declaration
   |
   = help: add 'namespace my_schema;' before use statements
```

---

### KPR0010: EmptyFileList

**Severity:** Error
**Phase:** Parsing

**Message:**

```
no files provided to compile
```

**Primary Span:** None (invocation-level error)

**Help:** Ensure the schema directory contains `.ks` files and the glob pattern matches.

**Example:**

```
error[KPR0010]: no files provided to compile
   |
   = help: check that schema/*.ks files exist
```

## References

- [ERR-0001](/specs/err/err-0001) - Error System Overview
- [RFC-0023](/specs/rfc/rfc-0023) - Error Handling Design
- [TSY-0010](/specs/tsy/tsy-0010) - Namespace Rules
