---
author: joshua-auchincloss
components:
  - parser
  - compiler
created: 2025-12-25
kind: ERR
number: 5
status: draft
title: Type Definition Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-25
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0005: Type Definition Errors

## Overview

This specification defines the KTY (Kintsu Type definition) error domain, covering all errors related to struct, enum, error, and oneof type declarations in Kintsu schema files.

## Domain Summary

| Code    | Name                     | Severity | Category   |
| ------- | ------------------------ | -------- | ---------- |
| KTY3001 | IdentConflict            | Error    | Conflict   |
| KTY3002 | DuplicateType            | Error    | Conflict   |
| KTY3003 | DuplicateField           | Error    | Conflict   |
| KTY5001 | TypeCircularDependency   | Error    | Cycle      |
| KTY2001 | MissingErrorType         | Error    | Validation |
| KTY2002 | UnionOperandMustBeStruct | Error    | Validation |

---

## Error Definitions

### KTY3001: IdentConflict

**Severity:** Error
**Phase:** Parsing

**Message:**

```
{namespace} has conflicts. {tag} {ident} is declared multiple times
```

**Primary Span:** The duplicate identifier declaration

**Related Spans:** The original declaration location

**Help:** Rename one of the conflicting declarations to have a unique name within the namespace.

**Example:**

```
error[KTY3001]: api::v1 has conflicts. struct User is declared multiple times
  --> schema/api/v1/models.ks:15:1
   |
 5 | struct User {
   | ----------- first declaration here
   |
15 | struct User {
   | ^^^^^^^^^^^ duplicate declaration
   |
   = help: rename one of the `User` structs to have a unique name
```

**References:** [TSY-0002](/specs/tsy/tsy-0002) (Struct Syntax)

---

### KTY3002: DuplicateType

**Severity:** Error
**Phase:** Compilation

**Message:**

```
duplicate type '{name}' already registered
```

**Primary Span:** The duplicate type registration

**Related Spans:** The original registration location

**Help:** Each type name must be unique within its namespace. Rename the duplicate type.

**Example:**

```
error[KTY3002]: duplicate type 'Response' already registered
  --> schema/api/handlers.ks:20:1
   |
   = note: first registered at schema/api/models.ks:10:1
   |
20 | struct Response {
   | ^^^^^^^^^^^^^^^ duplicate type name
   |
   = help: rename this type to avoid conflict with existing `Response`
```

**References:** [SPEC-0010](/specs/spec/spec-0010) (Type Registry)

---

### KTY3003: DuplicateField

**Severity:** Error
**Phase:** Parsing

**Message:**

```
duplicate field '{name}' in {type_kind} '{type_name}'
```

**Primary Span:** The duplicate field declaration

**Related Spans:** The original field declaration

**Help:** Field names must be unique within a type definition. Rename the duplicate field.

**Example:**

```
error[KTY3003]: duplicate field 'id' in struct 'User'
  --> schema/models.ks:5:5
   |
 3 |     id: u64,
   |     -- first declaration here
   |
 5 |     id: string,
   |     ^^ duplicate field name
   |
   = help: rename one of the `id` fields
```

**References:** [TSY-0002](/specs/tsy/tsy-0002) (Struct Syntax)

---

### KTY5001: TypeCircularDependency

**Severity:** Error
**Phase:** Compilation

**Message:**

```
circular type dependency detected: {types...}
```

Where `{types...}` is the dependency chain joined by `->`.

**Primary Span:** The type that closes the cycle

**Related Spans:** Each type in the dependency chain

**Help:** Break the circular dependency by introducing indirection (e.g., using an alias or restructuring types).

**Example:**

```
error[KTY5001]: circular type dependency detected: User -> Profile -> User
  --> schema/models.ks:10:5
   |
 3 | struct User {
   | ----------- cycle starts here
   |
 7 | struct Profile {
   | -------------- references User
   |
10 |     user: User,
   |     ^^^^^^^^^^ completes the cycle
   |
   = help: break the cycle by using an alias or restructuring the types
```

**References:** [SPEC-0010](/specs/spec/spec-0010) (Type Registry), [SPEC-0011](/specs/spec/spec-0011) (Type Resolution)

---

### KTY2001: MissingErrorType

**Severity:** Error
**Phase:** Validation

**Message:**

```
operation '{operation}' returns a fallible type but has no error type defined
```

**Primary Span:** The operation declaration

**Help:** Add an `#[err(...)]` attribute specifying the error type for the fallible operation.

**Example:**

```
error[KTY2001]: operation 'create_user' returns a fallible type but has no error type defined
  --> schema/api/users.ks:5:1
   |
 5 | operation create_user(input: CreateUserInput) -> User!;
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ fallible operation
   |
   = help: add an error type attribute: `#[err(CreateUserError)]`
```

**References:** [TSY-0009](/specs/tsy/tsy-0009) (Operation Syntax), [RFC-0009](/specs/rfc/rfc-0009) (Operation Design)

---

### KTY2002: UnionOperandMustBeStruct

**Severity:** Error
**Phase:** Compilation

**Message:**

```
union operand must be struct type: found {found_type} '{operand_name}'
```

**Primary Span:** The non-struct operand in the union expression

**Help:** Union operations (`&`) can only combine struct types. Replace the operand with a struct or wrap it in a struct.

**Example:**

```
error[KTY2002]: union operand must be struct type: found enum 'Status'
  --> schema/models.ks:15:24
   |
15 | type Combined = User & Status;
   |                        ^^^^^^ expected struct, found enum
   |
   = help: union operations require struct types
   = help: wrap `Status` in a struct if you need to include it
```

**References:** [TSY-0007](/specs/tsy/tsy-0007) (Union Types), [SPEC-0012](/specs/spec/spec-0012) (Union Compilation)

---

## References

- [RFC-0023](/specs/rfc/rfc-0023) - Error Handling Design
- [SPEC-0022](/specs/spec/spec-0022) - Error System Architecture
- [ERR-0001](/specs/err/err-0001) - Error System Overview
- [TSY-0002](/specs/tsy/tsy-0002) - Struct Syntax
- [TSY-0009](/specs/tsy/tsy-0009) - Union Syntax
- [SPEC-0010](/specs/spec/spec-0010) - Type Registry
- [SPEC-0011](/specs/spec/spec-0011) - Type Resolution
