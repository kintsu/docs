---
author: joshua-auchincloss
components:
  - compiler
created: 2025-12-25
kind: ERR
number: 9
status: draft
title: Tagging Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-25
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0009: Tagging Errors

## Overview

This specification defines the KTG (Kintsu TaGging) error domain, covering all errors related to variant tagging in `oneof` and `error` types.

## Domain Summary

| Code    | Name                      | Severity | Category   |
| ------- | ------------------------- | -------- | ---------- |
| KTG2001 | TagParameterInvalidType   | Error    | Validation |
| KTG3001 | MultipleTagStyles         | Error    | Conflict   |
| KTG2002 | TagOnNonVariantType       | Error    | Validation |
| KTG3002 | InternalTagFieldConflict  | Error    | Conflict   |
| KTG3003 | AdjacentFieldNameConflict | Error    | Conflict   |
| KTG3004 | UntaggedDuplicateType     | Error    | Conflict   |
| KTG3005 | UntaggedIndistinguishable | Error    | Conflict   |
| KTG2003 | InternalTagRequiresStruct | Error    | Validation |

---

## Error Definitions

### KTG2001: TagParameterInvalidType

**Severity:** Error
**Phase:** Parsing

**Message:**

```
attribute 'tag' parameter '{param}' must be a string literal
```

**Primary Span:** The invalid parameter value

**Help:** Tag attribute parameters like `name` must be string literals.

**Example:**

```
error[KTG2001]: attribute 'tag' parameter 'name' must be a string literal
  --> schema/models.ks:1:13
   |
 1 | #[tag(name = 42)]
   |               ^^ expected string literal, found integer
   |
   = help: use a string: `#[tag(name = "type")]`
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Tagging Syntax), [SPEC-0016](/specs/spec/spec-0016) (Tagging Compilation)

---

### KTG3001: MultipleTagStyles

**Severity:** Error
**Phase:** Parsing

**Message:**

```
attribute 'tag' specifies multiple tagging styles
```

**Primary Span:** The tag attribute with multiple styles

**Help:** A tag attribute can only specify one tagging style (external, internal, adjacent, or untagged).

**Example:**

```
error[KTG3001]: attribute 'tag' specifies multiple tagging styles
  --> schema/models.ks:1:1
   |
 1 | #[tag(external, internal)]
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ multiple styles specified
   |
   = help: choose one tagging style: `#[tag(external)]` or `#[tag(internal)]`
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Tagging Syntax)

---

### KTG2002: TagOnNonVariantType

**Severity:** Error
**Phase:** Validation

**Message:**

```
attribute 'tag' can only be applied to oneof or error types
```

**Primary Span:** The tag attribute on an invalid type

**Help:** Tagging attributes control discriminated union serialization and can only be used on `oneof` or `error` types.

**Example:**

```
error[KTG2002]: attribute 'tag' can only be applied to oneof or error types
  --> schema/models.ks:2:1
   |
 1 | #[tag(external)]
   | ---------------- this tag attribute
 2 | struct User { ... }
   | ^^^^^^ cannot apply tagging to struct
   |
   = help: tagging attributes are only valid on `oneof` and `error` types
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Tagging Syntax)

---

### KTG3002: InternalTagFieldConflict

**Severity:** Error
**Phase:** Validation

**Message:**

```
internal tag field '{name}' conflicts with variant field of same name at variant {index}
```

**Primary Span:** The conflicting variant field

**Related Spans:** The tag attribute specifying the field name

**Help:** Internal tagging inserts a tag field into the variant content. Choose a different tag field name.

**Example:**

```
error[KTG3002]: internal tag field 'type' conflicts with variant field of same name at variant 0
  --> schema/models.ks:5:9
   |
 1 | #[tag(name = "type")]
   | --------------------- tag field name specified here
 2 | type Response = oneof
 3 |     {
 4 |         type: str,
   |         ^^^^^^^^^ conflicts with tag field
 5 |         data: str
 6 |     }
 7 |   | Error;
   |
   = help: rename the variant field or use a different tag name
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Tagging Syntax), [SPEC-0016](/specs/spec/spec-0016) (Internal Tagging Validation)

---

### KTG3003: AdjacentFieldNameConflict

**Severity:** Error
**Phase:** Validation

**Message:**

```
adjacent tag field and content field must have different names
```

**Primary Span:** The adjacent tag attribute

**Help:** Adjacent tagging uses two fields (tag and content). They must have different names.

**Example:**

```
error[KTG3003]: adjacent tag field and content field must have different names
  --> schema/models.ks:1:1
   |
 1 | #[tag(adjacent, tag = "data", content = "data")]
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 'data' used for both
   |
   = help: use different names: `tag = "type", content = "data"`
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Adjacent Tagging)

---

### KTG3004: UntaggedDuplicateType

**Severity:** Error
**Phase:** Validation

**Message:**

```
untagged oneof contains duplicate variant types
```

**Primary Span:** The duplicate type variant

**Related Spans:** The first occurrence of the type

**Help:** Untagged oneofs must distinguish variants by type. The same type cannot appear multiple times.

**Example:**

```
error[KTG3004]: untagged oneof contains duplicate variant types
  --> schema/models.ks:4:18
   |
 1 | #[tag(untagged)]
 2 | type Data = oneof
 3 |     str
   |     --- first occurrence of `str`
 4 |   | str;
   |     ^^^ duplicate type `str`
   |
   = help: use different types or switch to a tagged style
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Untagged Validation)

---

### KTG3005: UntaggedIndistinguishable

**Severity:** Error
**Phase:** Validation

**Message:**

```
untagged oneof contains structurally indistinguishable variants
```

**Primary Span:** The indistinguishable variant

**Related Spans:** The variant it conflicts with

**Help:** Struct variants in untagged oneofs must have different field signatures. Add or rename a field.

**Example:**

```
error[KTG3005]: untagged oneof contains structurally indistinguishable variants
  --> schema/models.ks:4:5
   |
 1 | #[tag(untagged)]
 2 | type Response = oneof
 3 |     { code: i32, message: str }
   |     --------------------------- fields: code, message
 4 |   | { code: i32, message: str };
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ same fields: code, message
   |
   = help: variants must have at least one different required field
   = help: add a distinguishing field or use tagged serialization
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Untagged Validation), [SPEC-0016](/specs/spec/spec-0016) (Distinguishability)

---

### KTG2003: InternalTagRequiresStruct

**Severity:** Error
**Phase:** Validation

**Message:**

```
internal tagging requires struct content, found {kind}
```

**Primary Span:** The non-struct variant

**Help:** Internal tagging inserts the tag field into the content. This requires struct variants.

**Example:**

```
error[KTG2003]: internal tagging requires struct content, found tuple
  --> schema/models.ks:4:5
   |
 1 | #[tag(name = "type")]
   | --------------------- internal tagging specified
 2 | type Value = oneof
 3 |     (i32)
   |     ^^^^^ tuple variant cannot have internal tag
 4 |   | { name: str };
   |
   = help: convert tuple variants to struct variants
   = help: or use external tagging: `#[tag(external)]`
```

**References:** [TSY-0013](/specs/tsy/tsy-0013) (Internal Tagging), [SPEC-0016](/specs/spec/spec-0016) (Internal Tagging Validation)

---

## References

- [RFC-0023](/specs/rfc/rfc-0023) - Error Handling Design
- [SPEC-0022](/specs/spec/spec-0022) - Error System Architecture
- [ERR-0001](/specs/err/err-0001) - Error System Overview
- [TSY-0013](/specs/tsy/tsy-0013) - Tagging Syntax
- [SPEC-0016](/specs/spec/spec-0016) - Tagging Compilation
