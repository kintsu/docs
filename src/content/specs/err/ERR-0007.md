---
author: joshua-auchincloss
components:
  - compiler
created: 2025-12-25
kind: ERR
number: 7
status: draft
title: Union Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-25
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0007: Union Errors

## Overview

This specification defines the KUN (Kintsu UNion) error domain, covering all errors related to union type operations, field merging, and union-or composition in Kintsu schema files.

## Domain Summary

| Code    | Name                  | Severity | Category   |
| ------- | --------------------- | -------- | ---------- |
| KUN2001 | UnionOperandNotStruct | Error    | Validation |
| KUN3001 | UnionFieldConflict    | Warning  | Conflict   |
| KUN8001 | UnionFieldShadowed    | Warning  | Warning    |

---

## Error Definitions

### KUN2001: UnionOperandNotStruct

**Severity:** Error
**Phase:** Compilation

**Message:**

```
union operand must be struct type: found {found_type} '{operand_name}'
```

**Primary Span:** The non-struct operand in the union expression

**Help:** Union operations can only combine struct types. Replace the operand with a struct or wrap it in a struct.

**Example:**

```
error[KUN2001]: union operand must be struct type: found enum 'Status'
  --> schema/models.ks:15:24
   |
15 | type Combined = User & Status;
   |                        ^^^^^^ expected struct, found enum
   |
   = help: union operations require struct types
   = help: wrap `Status` in a struct if you need to include it
```

**Notes:**

Union operands must resolve to struct types. The following are rejected:

- **Enum**: "union operand must be struct, found enum"
- **Error**: "union operand must be struct, found error"
- **OneOf**: "union operand must be struct, found oneof"
- **Operation/Namespace**: "union operand must be struct"

**References:** [TSY-0009](/specs/tsy/tsy-0009) (Union Syntax), [SPEC-0007](/specs/spec/spec-0007) (Union Compilation)

---

### KUN3001: UnionFieldConflict

**Severity:** Warning
**Phase:** Compilation

**Message:**

```
union field conflict: field '{field_name}' appears in multiple operands with different types
```

**Primary Span:** The conflicting field in the later operand

**Related Spans:** The field in the earlier operand that takes precedence

**Help:** In union operations, leftmost field definitions win. The field from the later operand will be ignored.

**Example:**

```
warning[KUN3001]: union field conflict: field 'version' appears in multiple operands with different types
  --> schema/models.ks:20:5
   |
 5 | struct Base {
   | -----------
 6 |     version: str,
   |     ------------ leftmost definition wins (str)
   |
15 | struct Extended {
   | ----------------
16 |     version: i32,
   |     ^^^^^^^^^^^^ conflicting definition ignored (i32)
   |
20 | type Combined = Base & Extended;
   |                 ---- union expression
   |
   = note: leftmost field definition takes precedence
   = help: rename one field to preserve both definitions
```

**References:** [TSY-0007](/specs/tsy/tsy-0007) (Union Types), [SPEC-0012](/specs/spec/spec-0012) (Union Compilation)

---

### KUN8001: UnionFieldShadowed

**Severity:** Warning
**Phase:** Compilation

**Message:**

```
field '{field_name}' from '{operand_name}' is shadowed by earlier operand
```

**Primary Span:** The shadowed field

**Related Spans:** The field that shadows it

**Help:** This field will not appear in the merged result. Consider renaming if both fields are needed.

**Example:**

```
warning[KUN8001]: field 'id' from 'Permissions' is shadowed by earlier operand
  --> schema/models.ks:12:5
   |
 3 |     id: u64,
   |     ------- `User.id` takes precedence
   |
12 |     id: str,
   |     ^^^^^^^ this field is shadowed
   |
15 | type Admin = User & Permissions;
   |
   = note: union field merging uses left-to-right precedence
   = help: rename `Permissions.id` if both fields are needed
```

**References:** [TSY-0007](/specs/tsy/tsy-0007) (Union Types), [SPEC-0012](/specs/spec/spec-0012) (Union Compilation)

---

## Design Notes

### Union Field Merging

Union operations merge fields from multiple struct operands:

1. **Left-to-right precedence**: Fields from earlier operands take precedence
2. **Deterministic resolution**: Same input always produces same output
3. **Warning on conflict**: Conflicts are reported but do not fail compilation
4. **Field order preservation**: Merged fields maintain first-occurrence order

### Union-Or Operations

The `&|` operator (union-or) handles conflicts differently by producing `oneof` for conflicting fields. Errors specific to union-or operations use the same KUN domain.

## References

- [RFC-0023](/specs/rfc/rfc-0023) - Error Handling Design
- [SPEC-0022](/specs/spec/spec-0022) - Error System Architecture
- [ERR-0001](/specs/err/err-0001) - Error System Overview
- [TSY-0007](/specs/tsy/tsy-0007) - Union Types
- [SPEC-0012](/specs/spec/spec-0012) - Union Compilation
