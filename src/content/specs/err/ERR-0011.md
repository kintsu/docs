---
author: joshua-auchincloss
components:
  - compiler
created: 2025-12-25
kind: ERR
number: 11
status: draft
title: Package Errors
updates:
  - author: joshua-auchincloss
    date: 2025-12-26
    description: Added validation errors (KPK2001-2004), resolution errors (KPK1001-1002), file field errors (KPK4003-4004); corrected manifest filename to schema.toml
  - author: joshua-auchincloss
    date: 2025-12-25
    description: Created specification
version_after: 0.1.0
version_before: null
---

# ERR-0011: Package Errors

## Overview

This specification defines the KPK (Kintsu PacKage) error domain, covering all errors related to package manifests (`schema.toml`), lockfiles, and dependency resolution.

## Domain Summary

### Syntax Errors

| Code    | Name               | Severity | Category |
| ------- | ------------------ | -------- | -------- |
| KPK0001 | ManifestParseError | Error    | Syntax   |

### Resolution Errors

| Code    | Name                       | Severity | Category   |
| ------- | -------------------------- | -------- | ---------- |
| KPK1001 | DependencyResolutionFailed | Error    | Resolution |
| KPK1002 | VersionConflict            | Error    | Resolution |

### Validation Errors

| Code    | Name                     | Severity | Category   |
| ------- | ------------------------ | -------- | ---------- |
| KPK2001 | InvalidPackageName       | Error    | Validation |
| KPK2002 | InvalidVersionConstraint | Error    | Validation |
| KPK2003 | InvalidDependencySpec    | Error    | Validation |
| KPK2004 | FileSizeExceeded         | Error    | Validation |

### Conflict Errors

| Code    | Name                | Severity | Category |
| ------- | ------------------- | -------- | -------- |
| KPK3001 | DuplicateDependency | Error    | Conflict |

### Missing Errors

| Code    | Name                  | Severity | Category |
| ------- | --------------------- | -------- | -------- |
| KPK4001 | ManifestNotFound      | Error    | Missing  |
| KPK4002 | LockfileNotFound      | Error    | Missing  |
| KPK4003 | FileFieldPathNotFound | Error    | Missing  |
| KPK4004 | FileFieldReadError    | Error    | Missing  |

### Compatibility Errors

| Code    | Name                      | Severity | Category      |
| ------- | ------------------------- | -------- | ------------- |
| KPK6001 | DependencyVersionMismatch | Error    | Compatibility |
| KPK6002 | LockfileOutOfDate         | Warning  | Compatibility |

---

## Error Definitions

### KPK0001: ManifestParseError

**Severity:** Error
**Phase:** Initialisation

**Message:**

```
failed to parse schema.toml: {reason}
```

**Primary Span:** The invalid line or token in the manifest

**Help:** Fix the TOML syntax error in your `schema.toml` file.

**Example:**

```
error[KPK0001]: failed to parse schema.toml: expected '=' after key
  --> schema.toml:5:12
   |
 5 | name "my-package"
   |      ^ expected '='
   |
   = help: use `name = "my-package"`
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK1001: DependencyResolutionFailed

**Severity:** Error
**Phase:** Dependency Resolution

**Message:**

```
failed to resolve dependency graph
```

**Primary Span:** N/A (overall resolution failure)

**Help:** Check that all dependencies exist and version constraints are satisfiable.

**Example:**

```
error[KPK1001]: failed to resolve dependency graph
   |
   = note: could not find a version of 'common-types' satisfying all constraints
   = help: run `kintsu tree` to inspect the dependency graph
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK1002: VersionConflict

**Severity:** Error
**Phase:** Dependency Resolution

**Message:**

```
version conflict: '{package}' required as {version1} and {version2}
```

**Primary Span:** The conflicting dependency declarations

**Help:** Update version constraints to find a compatible version.

**Example:**

```
error[KPK1002]: version conflict: 'common-types' required as ^1.0 and ^2.0
  --> schema.toml:8:1
   |
 8 | common-types = "^1.0"
   | ^^^^^^^^^^^^^^^^^^^^^ requires ^1.0
   |
   = note: api-utils@1.0 requires common-types@^2.0
   = help: try updating to common-types@^2.0 for compatibility
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK2001: InvalidPackageName

**Severity:** Error
**Phase:** Validation

**Message:**

```
invalid package name '{name}': {reason}
```

**Primary Span:** The package name field

**Help:** Package names must be kebab-case, at least 2 characters, matching `[a-z]([a-z0-9\-]*)[a-z0-9]`.

**Example:**

```
error[KPK2001]: invalid package name 'My-Package': must be lowercase
  --> schema.toml:3:8
   |
 3 | name = "My-Package"
   |        ^^^^^^^^^^^^ invalid package name
   |
   = help: use `name = "my-package"` (lowercase with hyphens)
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK2002: InvalidVersionConstraint

**Severity:** Error
**Phase:** Validation

**Message:**

```
invalid version constraint '{constraint}': {reason}
```

**Primary Span:** The version constraint

**Help:** Use semver syntax: `^1.0`, `~1.2.3`, `>=1.0, <2.0`, `1.x`, `*`.

**Example:**

```
error[KPK2002]: invalid version constraint 'latest': not a valid semver requirement
  --> schema.toml:8:18
   |
 8 | common-types = "latest"
   |                ^^^^^^^^ invalid version constraint
   |
   = help: use semver syntax like "^1.0" or ">=1.0, <2.0"
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK2003: InvalidDependencySpec

**Severity:** Error
**Phase:** Validation

**Message:**

```
invalid dependency specification for '{name}': {reason}
```

**Primary Span:** The dependency entry

**Help:** Check the dependency syntax in the manifest.

**Example:**

```
error[KPK2003]: invalid dependency specification for 'common': missing version or path
  --> schema.toml:8:1
   |
 8 | common = { registry = "corp" }
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing version field
   |
   = help: specify version: `common = { version = "^1.0", registry = "corp" }`
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK2004: FileSizeExceeded

**Severity:** Error
**Phase:** Validation

**Message:**

```
file '{path}' exceeds maximum size for {field}: {size} > {limit}
```

**Primary Span:** The file-based field

**Help:** Reduce the file size or use inline content.

**Example:**

```
error[KPK2004]: file './README.md' exceeds maximum size for readme: 2.5MB > 1MB
  --> schema.toml:7:10
   |
 7 | readme = { path = "./README.md" }
   |          ^^^^^^^^^^^^^^^^^^^^^^^^ file too large
   |
   = help: reduce file size to under 1MB or use inline content
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK3001: DuplicateDependency

**Severity:** Error
**Phase:** Initialisation

**Message:**

```
duplicate dependency '{name}' in schema.toml
```

**Primary Span:** The duplicate dependency entry

**Help:** Remove the duplicate dependency declaration.

**Example:**

```
error[KPK3001]: duplicate dependency 'common' in schema.toml
  --> schema.toml:12:1
   |
 8 | common = "^1.0.0"
   | ----------------- first declaration
   |
12 | common = "^2.0.0"
   | ^^^^^^^^^^^^^^^^^ duplicate declaration
   |
   = help: remove one of the duplicate entries
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK4001: ManifestNotFound

**Severity:** Error
**Phase:** Initialisation

**Message:**

```
schema.toml not found in {directory}
```

**Primary Span:** N/A (no source location)

**Help:** Create a `schema.toml` file in your project root.

**Example:**

```
error[KPK4001]: schema.toml not found in /path/to/project
   |
   = help: run `kintsu init` to create a new package
   = help: or create schema.toml manually
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK4002: LockfileNotFound

**Severity:** Error
**Phase:** Dependency Resolution

**Message:**

```
schema.lock.toml not found but dependencies are specified
```

**Primary Span:** N/A (no source location)

**Help:** Run `kintsu update` to generate the lockfile.

**Example:**

```
error[KPK4002]: schema.lock.toml not found but dependencies are specified
   |
   = help: run `kintsu update` to resolve and lock dependencies
```

**References:** [RFC-0020](/specs/rfc/RFC-0020) (Lockfile Format)

---

### KPK4003: FileFieldPathNotFound

**Severity:** Error
**Phase:** Validation

**Message:**

```
file not found: '{path}' for {field} field
```

**Primary Span:** The file-based field

**Help:** Check the path is correct and the file exists.

**Example:**

```
error[KPK4003]: file not found: './DESCRIPTION.md' for description field
  --> schema.toml:6:15
   |
 6 | description = { path = "./DESCRIPTION.md" }
   |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ file not found
   |
   = help: create the file or use inline content
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK4004: FileFieldReadError

**Severity:** Error
**Phase:** Validation

**Message:**

```
failed to read file '{path}' for {field}: {reason}
```

**Primary Span:** The file-based field

**Help:** Check file permissions and encoding (must be UTF-8).

**Example:**

```
error[KPK4004]: failed to read file './LICENSE' for license_text: invalid UTF-8
  --> schema.toml:8:16
   |
 8 | license_text = { path = "./LICENSE" }
   |                ^^^^^^^^^^^^^^^^^^^^^^ file read error
   |
   = help: ensure the file is valid UTF-8 encoded text
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK6001: DependencyVersionMismatch

**Severity:** Error
**Phase:** Dependency Resolution

**Message:**

```
dependency version conflict: {package} requires {required}, but {other} requires {other_required}
```

**Primary Span:** The dependency declaration

**Help:** Resolve the version conflict by updating one of the dependencies.

**Example:**

```
error[KPK6001]: dependency version conflict: common requires ^1.0.0, but api requires ^2.0.0
  --> schema.toml:8:1
   |
 8 | common = "^1.0.0"
   | ^^^^^^^^^^^^^^^^^ requires ^1.0.0
   |
   = note: api@1.0.0 requires common@^2.0.0
   = help: update common to a version satisfying both constraints
```

**References:** [RFC-0019](/specs/rfc/RFC-0019) (Package Manifest Format)

---

### KPK6002: LockfileOutOfDate

**Severity:** Warning
**Phase:** Dependency Resolution

**Message:**

```
schema.lock.toml is out of date with schema.toml
```

**Primary Span:** N/A

**Help:** Run `kintsu update` to update the lockfile.

**Example:**

```
warning[KPK6002]: schema.lock.toml is out of date with schema.toml
   |
   = note: schema.toml has been modified since lockfile was generated
   = help: run `kintsu update` to update dependencies
```

**References:** [RFC-0020](/specs/rfc/RFC-0020) (Lockfile Format)

---

## References

- [RFC-0019](/specs/rfc/RFC-0019) - Package Manifest Format
- [RFC-0020](/specs/rfc/RFC-0020) - Lockfile Format
- [ERR-0001](/specs/err/ERR-0001) - Error System Overview
